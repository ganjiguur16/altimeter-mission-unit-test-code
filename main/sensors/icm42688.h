// Minimal ICM-42688-P probe helpers (I2C)
#pragma once
#include "esp_err.h"
#include "driver/i2c_master.h"

// Device identification
#define ICM42688_REG_WHO_AM_I 0x75
#define ICM42688_WHO_AM_I_VAL 0x47

// Device configuration registers
#define ICM42688_REG_DEVICE_CONFIG  0x11
#define ICM42688_REG_DRIVE_CONFIG   0x13
#define ICM42688_REG_INT_CONFIG     0x14
#define ICM42688_REG_FIFO_CONFIG    0x16
#define ICM42688_REG_TEMP_DATA1     0x1D
#define ICM42688_REG_TEMP_DATA0     0x1E
#define ICM42688_REG_ACCEL_DATA_X1  0x1F
#define ICM42688_REG_ACCEL_DATA_X0  0x20
#define ICM42688_REG_ACCEL_DATA_Y1  0x21
#define ICM42688_REG_ACCEL_DATA_Y0  0x22
#define ICM42688_REG_ACCEL_DATA_Z1  0x23
#define ICM42688_REG_ACCEL_DATA_Z0  0x24
#define ICM42688_REG_GYRO_DATA_X1   0x25
#define ICM42688_REG_GYRO_DATA_X0   0x26
#define ICM42688_REG_GYRO_DATA_Y1   0x27
#define ICM42688_REG_GYRO_DATA_Y0   0x28
#define ICM42688_REG_GYRO_DATA_Z1   0x29
#define ICM42688_REG_GYRO_DATA_Z0   0x2A

// Power management
#define ICM42688_REG_PWR_MGMT0     0x4E
#define ICM42688_PWR_MGMT0_TEMP_DIS_MASK  UINT8_C(0x20)
#define ICM42688_PWR_MGMT0_IDLE_MASK      UINT8_C(0x10)
#define ICM42688_PWR_MGMT0_GYRO_MODE_MASK UINT8_C(0x0C)
#define ICM42688_PWR_MGMT0_ACCEL_MODE_MASK UINT8_C(0x03)
#define ICM42688_PWR_MGMT0_GYRO_OFF       UINT8_C(0x00)
#define ICM42688_PWR_MGMT0_GYRO_STANDBY   UINT8_C(0x04)
#define ICM42688_PWR_MGMT0_GYRO_LN        UINT8_C(0x08)
#define ICM42688_PWR_MGMT0_GYRO_LP        UINT8_C(0x0C)
#define ICM42688_PWR_MGMT0_ACCEL_OFF      UINT8_C(0x00)
#define ICM42688_PWR_MGMT0_ACCEL_LP       UINT8_C(0x02)
#define ICM42688_PWR_MGMT0_ACCEL_LN       UINT8_C(0x03)

// Gyroscope configuration
#define ICM42688_REG_GYRO_CONFIG0  0x4F
#define ICM42688_GYRO_CONFIG0_ODR_MASK     UINT8_C(0x0F)
#define ICM42688_GYRO_CONFIG0_FS_SEL_MASK  UINT8_C(0x70)
#define ICM42688_GYRO_CONFIG0_FS_SEL_2000  UINT8_C(0x00)
#define ICM42688_GYRO_CONFIG0_FS_SEL_1000  UINT8_C(0x10)
#define ICM42688_GYRO_CONFIG0_FS_SEL_500   UINT8_C(0x20)
#define ICM42688_GYRO_CONFIG0_FS_SEL_250   UINT8_C(0x30)
#define ICM42688_GYRO_CONFIG0_FS_SEL_125   UINT8_C(0x40)
#define ICM42688_GYRO_CONFIG0_FS_SEL_62_5  UINT8_C(0x50)
#define ICM42688_GYRO_CONFIG0_FS_SEL_31_25 UINT8_C(0x60)
#define ICM42688_GYRO_CONFIG0_FS_SEL_15_625 UINT8_C(0x70)

// Accelerometer configuration
#define ICM42688_REG_ACCEL_CONFIG0 0x50
#define ICM42688_ACCEL_CONFIG0_ODR_MASK    UINT8_C(0x0F)
#define ICM42688_ACCEL_CONFIG0_FS_SEL_MASK UINT8_C(0x70)
#define ICM42688_ACCEL_CONFIG0_FS_SEL_16G  UINT8_C(0x00)
#define ICM42688_ACCEL_CONFIG0_FS_SEL_8G   UINT8_C(0x10)
#define ICM42688_ACCEL_CONFIG0_FS_SEL_4G   UINT8_C(0x20)
#define ICM42688_ACCEL_CONFIG0_FS_SEL_2G   UINT8_C(0x30)

// Gyroscope and accelerometer configurations
#define ICM42688_REG_GYRO_CONFIG1  0x51
#define ICM42688_REG_GYRO_ACCEL_CONFIG0 0x52
#define ICM42688_REG_ACCEL_CONFIG1 0x53

// Interrupt configuration
#define ICM42688_REG_INT_CONFIG0   0x63
#define ICM42688_REG_INT_CONFIG1   0x64
#define ICM42688_REG_INT_SOURCE0   0x65
#define ICM42688_REG_INT_SOURCE1   0x66
#define ICM42688_REG_INT_SOURCE3   0x68
#define ICM42688_REG_INT_SOURCE4   0x69

// FIFO configuration
#define ICM42688_REG_FIFO_CONFIG1  0x5F
#define ICM42688_REG_FIFO_CONFIG2  0x60
#define ICM42688_REG_FIFO_CONFIG3  0x61
#define ICM42688_REG_FIFO_COUNTH   0x2E
#define ICM42688_REG_FIFO_COUNTL   0x2F
#define ICM42688_REG_FIFO_DATA     0x30

// Bank selection
#define ICM42688_REG_BANK_SEL      0x76
#define ICM42688_REG_MADDR         0x00

// Self-test registers
#define ICM42688_REG_SELF_TEST_CONFIG  0x70
#define ICM42688_REG_SELF_TEST_GYRO_X  0x71
#define ICM42688_REG_SELF_TEST_GYRO_Y  0x72
#define ICM42688_REG_SELF_TEST_GYRO_Z  0x73
#define ICM42688_REG_SELF_TEST_ACCEL_X 0x74
#define ICM42688_REG_SELF_TEST_ACCEL_Y 0x75
#define ICM42688_REG_SELF_TEST_ACCEL_Z 0x76

// Output data rates
#define ICM42688_ODR_32KHZ    UINT8_C(0x01)
#define ICM42688_ODR_16KHZ    UINT8_C(0x02)
#define ICM42688_ODR_8KHZ     UINT8_C(0x03)
#define ICM42688_ODR_4KHZ     UINT8_C(0x04)
#define ICM42688_ODR_2KHZ     UINT8_C(0x05)
#define ICM42688_ODR_1KHZ     UINT8_C(0x06)
#define ICM42688_ODR_500HZ    UINT8_C(0x07)
#define ICM42688_ODR_200HZ    UINT8_C(0x08)
#define ICM42688_ODR_100HZ    UINT8_C(0x09)
#define ICM42688_ODR_50HZ     UINT8_C(0x0A)
#define ICM42688_ODR_25HZ     UINT8_C(0x0B)
#define ICM42688_ODR_12_5HZ   UINT8_C(0x0C)
#define ICM42688_ODR_6_25HZ   UINT8_C(0x0D)
#define ICM42688_ODR_3_125HZ  UINT8_C(0x0E)
#define ICM42688_ODR_1_5625HZ UINT8_C(0x0F)

// API Function declarations
esp_err_t icm42688_probe(i2c_master_bus_handle_t bus,
                         uint8_t addr,
                         i2c_master_dev_handle_t *out_dev,
                         uint8_t *out_whoami);
